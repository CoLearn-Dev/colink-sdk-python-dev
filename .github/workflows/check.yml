name: colink_python_check
on:
  push:
    branches:
      - main
  pull_request:
jobs:
  colink_python_check:
    runs-on:  ubuntu-latest
    defaults:
      run:
        shell: bash
    services:
      rabbitmq:
        image: rabbitmq:3.8-management
        ports:
          - 5672:5672      
          - 15672:15672
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          submodules: recursive
      - name: Download Server
        run: bash download-server.sh
      - name: Install Python
        uses: actions/setup-python@v3
        with:
          python-version: "3.9"
          architecture: "x64"
      - name: Install Requirements
        run: pip install  .
      - name: Install Pytest
        run: pip install pytest
      - name: Run test1
        run: pytest test/test_protocol_variable_transfer.py
        timeout-minutes: 4
      - name: Run test2
        run: pytest test/test_python.py
        timeout-minutes: 4
